\ProvidesPackage{univesp}[2015/01/22 v0.1 - Lista de exercícios da Univesp]

\RequirePackage{ifthen}
\RequirePackage{everypage}
\RequirePackage[left=52mm, top=52mm, right=33mm, bottom=33mm, a4paper]{geometry}
\RequirePackage{tikz}
\RequirePackage{xcolor}

% Flag univesp@mediador controls if the document is targeted to mediators or students.
\newif\ifunivesp@mediador

\DeclareOption{mediador}{%
  \global\univesp@mediadortrue
}

\DeclareOption{aluno}{%
  \global\univesp@mediadorfalse
}

\newif\ifunivesp@prova

\DeclareOption{prova}{%
  \global\univesp@provatrue% <-- Without this % it does not work! :s
  \gdef\univesp@exercicio{QUESTÃO}
}

\DeclareOption{exercicios}{%
  \global\univesp@provafalse% <-- Without this % it does not work! :s
  \gdef\univesp@exercicio{EXERCÍCIO}
}

% Flag univesp@at@answers indicates whether LaTeX is processing the answers section.
% It always starts at false.
\newif\ifunivesp@at@answers
\global\univesp@at@answersfalse


\ExecuteOptions{aluno,exercicios}
\ProcessOptions\relax



\usetikzlibrary{calc}

% Remove footers
\pagestyle{empty}

\definecolor{textblue}{rgb}{0.137,0.392,0.706}

\newcounter{exercicio}
\setcounter{exercicio}{0}
\providecommand\exercicio{{%
  \refstepcounter{exercicio}%
  \par\bigskip% TODO: definir um comprimento elástico
  \noindent
  \color{textblue}%
  \fontsize{13pt}{15pt}\selectfont% TODO: verificar
  \univesp@exercicio~\theexercicio
  \par
}}

\AtBeginDocument{
  %\newgeometry{left=52mm, top=52mm, right=33mm, bottom=33mm}
  \fontsize{11.5pt}{15pt}\selectfont
  }% TODO: verificar

  
  \AddEverypageHook{
    \ifthenelse{\equal{\thepage}{1}}{%
      \begin{tikzpicture}[remember picture, overlay]
	\definecolor{azul_univesp}{rgb}{0.565,0.690,0.843};
	\node (a) at ($(current page.south west) + (1cm,1cm)$) {};
	\node (b) at ($(current page.north east) - (1cm,1cm)$) {};
	\filldraw[fill=azul_univesp,even odd rule, draw opacity=0] (current page.south west) rectangle (current page.north east) (a) rectangle (b);
	\node at ($(current page.north east) - (3.4cm,2cm)$) {\includegraphics[width=3cm]{univesp}};
	\node [align=left] at ($(current page.south west)+(5cm,2.4cm)$) [anchor=west] {%
	    {\color[rgb]{0.137,0.392,0.706}\rule[0.5em]{\textwidth}{0.1pt}}\\%
	    \color[rgb]{0.137,0.392,0.706}%
	    \fontsize{7.5}{8.5}\selectfont%
	    Física II para engenharia
	    \textbf{/ Exercícios das aulas 1--2}%
	    \hfill%
	    \fontsize{9}{10}\selectfont%
	    \thepage};
      \end{tikzpicture}
    }{
      \ifunivesp@at@answers
	\begin{tikzpicture}[remember picture, overlay]
	  \definecolor{outro_azul_univesp}{rgb}{0.870,0.910,0.957};
	  \node (a) at ($(current page.south west) + (1cm,1cm)$) {};
	  \node (b) at ($(current page.north east) - (1cm,1cm)$) {};
	  \filldraw[fill=outro_azul_univesp,even odd rule, draw opacity=0] (a) rectangle (b);
	\end{tikzpicture}
      \else
	\begin{tikzpicture}[remember picture, overlay]
	  \definecolor{azul_univesp}{rgb}{0.565,0.690,0.843};
	  \node (a) at ($(current page.north west) - (0cm,16.5cm)$) {};
	  \node (b) at ($(current page.north west) + (3.1cm,0cm)$) {};
	  \draw[color=azul_univesp, ultra thick] (a) -- (b);
	  \node[align=left] at ($(current page.south west)+(5cm,1.4cm)$) [anchor=west] {%
	    {\color[rgb]{0.137,0.392,0.706}\rule[0.5em]{\textwidth}{0.1pt}}\\%
	    \color[rgb]{0.137,0.392,0.706}%
	    \fontsize{7.5}{8.5}\selectfont%
	    Física II para engenharia
	    \textbf{/ Exercícios das aulas 1--2}%
	    \hfill%
	    \fontsize{9}{10}\selectfont%
	    \thepage};
	\end{tikzpicture}
      \fi
      }
  }
  
\providecommand\definedisciplina[1]{%
  \newcommand\nomedisciplina{\uppercase{#1}}
}

\providecommand\disciplina{{%
  \par%
  \noindent%
  \bfseries%
  \color{textblue}%
  \fontsize{20pt}{22pt}\selectfont% TODO: verificar
  \uppercase{\nomedisciplina}%
}}

\providecommand\aulas[1]{{%
  \par
  \noindent%
  \bfseries%
  \color{textblue}%
  \fontsize{13pt}{15pt}\selectfont % TODO: verificar
  LISTA DE EXERCÍCIOS DAS AULAS #1
}}

% Coloque as respostas no ambiente respostas
\newenvironment{respostas}{
  \ifunivesp@mediador\else
    \pagebreak%
    \global\univesp@at@answerstrue%
    \noindent%
    \begingroup
      \bfseries%
      \color{textblue}%
      \fontsize{20pt}{22pt}\selectfont% TODO: verificar
      \uppercase{GABARITO}%
    \endgroup
    \par
    \setcounter{exercicio}{0}
  \fi
}{}

% Coloque as resoluções no ambiente resolucoes
\newenvironment{resolucoes}{
  \ifunivesp@mediador
    \pagebreak%
    \global\univesp@at@answerstrue%
    \noindent%
    \begingroup
      \bfseries%
      \color[rgb]{0.137,0.392,0.706}%
      \fontsize{20pt}{22pt}\selectfont% TODO: verificar
      \uppercase{GABARITO DO MEDIADOR}%
    \endgroup
    \par
    \setcounter{exercicio}{0}
  \fi
}{}

% Use \foreign para estrangeirismos.
\newcommand\foreign[1]{\textsl{#1}}

\endinput